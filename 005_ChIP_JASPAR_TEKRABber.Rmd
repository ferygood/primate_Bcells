---
title: "intersection analysis"
output: html_document
---

### Data Information
The input tables are corrdinates information of KRAB-ZNFs and TEs based on 
different method. Two of them are matrices built using **JASPAR Core 
nonredundant vertebrates-2020 collection**, **Zinc finger motifs for human in 
the JASPAR Collection Unvalidated** and **collection of motifs assembled by 
Dogan et al**. Upon these four data are intersect by RNA-seq data result which 
include significantly correlated KRAB-ZNFs and TEs from TEKRABber's result.

```{r load data}
load("intersect/db_tight.rda") # database x TEKRABber tight
load("intersect/db_ext.rda") # database x TEKRABber -/+ 100bp
load("intersect/katja_tight.rda") # ChIP-seq x TEKRABber tight
load("intersect/katja_ext.rda") # ChIP-seq x TEKRABber -/+ 100bp

hm_db <- db_tight$hm
chimp_db <- db_tight$chimp
oran_db <- db_tight$oran
hm_db_ext <- db_ext$hm
chimp_db_ext <- db_ext$chimp
oran_db_ext <- db_ext$oran

hm_kat <- katja_tight$hm
chimp_kat <- katja_tight$chimp
oran_kat <- katja_tight$oran
hm_kat_ext <- katja_ext$hm
chimp_kat_ext <- katja_ext$chimp
oran_kat_ext <- katja_ext$oran


```

Q1: How many ZNFs and TEs found in the intersect data?
```{r}
printCount <- function(df){
    znfcount <- length(unique(df$ZNF_ms))
    tecount <- length(unique(df$te_name))
    paste0("unique znf/te count: ", znfcount, " & ", tecount)
}

dbList <- list(
    hm_db, hm_db_ext,
    chimp_db, chimp_db_ext,
    oran_db, oran_db_ext
)

print(lapply(dbList, printCount))

katjaList <- list(
    hm_kat, hm_kat_ext,
    chimp_kat, chimp_kat_ext,
    oran_kat, oran_kat_ext
) 

print(lapply(katjaList, printCount))
```

A1: from the results aboved, we can know the KZNFs and TEs found from exact and 
extend location are the same. 


Q2: we want to count the repeat ZNFs motifs & TE pairs in our data. Then we can
see the visualization of the heatmaps/bipartite plots.
```{r}
library(data.table)

# count how many same znf motifs and te names
countRepeat <- function(df, name) {
    df_count <- setDT(df[, c(1,2,3)])[, list(Count=.N), names(df[, c(1,2,3)])]
    path <- file.path("intersect", name)
    write.table(df_count, path, sep=",")
    df_count
}

countRepeat(hm_db, "hm_db_repeat.csv")
countRepeat(chimp_db, "chimp_db_repeat.csv")
countRepeat(oran_db, "oran_db_repeat.csv")
countRepeat(hm_kat, "hm_kat_repeat.csv")
countRepeat(chimp_kat, "chimp_kat_repeat.csv")
countRepeat(oran_kat, "oran_kat_repeat.csv")

```



```{r}
library(reshape2)
test <- countRepeat(hm_db, "hm_db_repeat.csv")
test <- test[test$chromosome=="chr19",]
test <- test[,c(1,3,4)]
test2 <- dcast(test, te_name~ZNF_ms)
rownames(test2) <- test2$te_name
test2 <- test2[-1]
test2[is.na(test2)] <- 0
heatmap(as.matrix(test2))
```

```{r}
library(reshape2)
test <- countRepeat(chimp_db, "chimp_db_repeat.csv")
test <- test[test$chromosome=="chr19",]
test <- test[,c(1,3,4)]
test2 <- dcast(test, te_name~ZNF_ms)
rownames(test2) <- test2$te_name
test2 <- test2[-1]
test2[is.na(test2)] <- 0
heatmap(as.matrix(test2))
```
